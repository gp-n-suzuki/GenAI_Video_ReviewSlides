<!DOCTYPE html>

<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>スライドビューア</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        :root { --toolbar-h: 56px; --accent: #2563eb; }
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; background: #0b1020; color: #e5e7eb; font-family: 'Noto Sans JP', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
        .app { position: fixed; inset: 0; display: flex; flex-direction: column; }
        .toolbar { height: var(--toolbar-h); display: flex; align-items: center; gap: 12px; padding: 0 12px; background: rgba(15, 23, 42, 0.9); backdrop-filter: saturate(150%) blur(8px); border-bottom: 1px solid rgba(100,116,139,.35); }
        .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; color: #e2e8f0; }
        .brand .badge { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 6px; background: var(--accent); color: white; }
        .controls { display: inline-flex; align-items: center; gap: 8px; }
        .btn { height: 36px; min-width: 36px; padding: 0 12px; border-radius: 8px; border: 1px solid rgba(148,163,184,.25); background: rgba(30,41,59,.6); color: #e5e7eb; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:hover { background: rgba(30,41,59,.85); }
        .btn[disabled] { opacity: .5; cursor: not-allowed; }
        .select { height: 36px; padding: 0 12px; border-radius: 8px; border: 1px solid rgba(148,163,184,.25); background: rgba(2,6,23,.6); color: #e5e7eb; }
        .meta { margin-left: auto; display: inline-flex; align-items: center; gap: 14px; color: #cbd5e1; font-size: 14px; }
        .title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 36vw; }
        .progress { position: absolute; left: 0; right: 0; top: var(--toolbar-h); height: 3px; background: rgba(148,163,184,.15); }
        .progress > span { display: block; height: 100%; width: 0%; background: linear-gradient(90deg, #22c55e, #eab308, #ef4444); transition: width .2s ease; }
        .stage { position: absolute; left: 0; right: 0; top: calc(var(--toolbar-h) + 3px); bottom: 0; }
        .frame { width: 100%; height: 100%; border: 0; background: #0b1020; }
        .hint { position: absolute; right: 12px; bottom: 12px; color: #94a3b8; font-size: 12px; opacity: .85; }
        @media (max-width: 640px) {
            .title { display: none; }
            .meta { gap: 8px; }
        }
    </style>
</head>

<body>
    <div class="app" id="app">
        <div class="toolbar">
            <div class="brand"><span class="badge"><i class="fas fa-film"></i></span><span>スライドビューア</span></div>
            <div class="controls">
                <button class="btn" id="firstBtn" title="最初 (Home)"><i class="fas fa-angles-left"></i></button>
                <button class="btn" id="prevBtn" title="前 (← / PageUp)"><i class="fas fa-chevron-left"></i></button>
                <select class="select" id="jumpSelect" title="スライドを選択"></select>
                <button class="btn" id="nextBtn" title="次 (→ / PageDown)"><i class="fas fa-chevron-right"></i></button>
                <button class="btn" id="lastBtn" title="最後 (End)"><i class="fas fa-angles-right"></i></button>
            </div>
            <div class="meta">
                <span id="counter">1 / 17</span>
                <span class="title" id="slideTitle">読み込み中…</span>
                <button class="btn" id="openBtn" title="このスライドを別タブで開く"><i class="fas fa-up-right-from-square"></i></button>
                <button class="btn" id="fullBtn" title="フルスクリーン (F)"><i class="fas fa-expand"></i></button>
            </div>
        </div>
        <div class="progress"><span id="progressBar"></span></div>
        <div class="stage">
            <iframe id="slideFrame" class="frame" src="" allow="fullscreen"></iframe>
            <div class="hint">← / → で移動・Fでフルスクリーン</div>
        </div>
    </div>

    <script>
        (function () {
            const total = 17;
            const slides = Array.from({ length: total }, (_, i) => `${i + 1}.html`);

            const frame = document.getElementById('slideFrame');
            const select = document.getElementById('jumpSelect');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const firstBtn = document.getElementById('firstBtn');
            const lastBtn = document.getElementById('lastBtn');
            const openBtn = document.getElementById('openBtn');
            const fullBtn = document.getElementById('fullBtn');
            const counter = document.getElementById('counter');
            const titleEl = document.getElementById('slideTitle');
            const progressBar = document.getElementById('progressBar');
            const app = document.getElementById('app');

            for (let i = 1; i <= total; i++) {
                const opt = document.createElement('option');
                opt.value = String(i);
                opt.textContent = `スライド ${i}`;
                select.appendChild(opt);
            }

            let index = 1;

            function clamp(n) { return Math.max(1, Math.min(total, n)); }

            function updateButtons() {
                prevBtn.disabled = index <= 1;
                firstBtn.disabled = index <= 1;
                nextBtn.disabled = index >= total;
                lastBtn.disabled = index >= total;
            }

            function updateMeta() {
                counter.textContent = `${index} / ${total}`;
                select.value = String(index);
                progressBar.style.width = `${(index - 1) / (total - 1) * 100}%`;
            }

            function loadSlide(n, pushHash = true) {
                index = clamp(n);
                frame.src = slides[index - 1];
                titleEl.textContent = '読み込み中…';
                if (pushHash) location.hash = `#${index}`;
                updateButtons();
                updateMeta();
            }

            function readFrameTitle() {
                try {
                    const doc = frame.contentDocument;
                    if (doc && doc.title) {
                        titleEl.textContent = doc.title;
                        document.title = `${doc.title} – スライドビューア`;
                        // 可能ならセレクトの表示名も更新
                        const opt = select.options[index - 1];
                        if (opt && !opt.textContent.includes('—')) {
                            opt.textContent = `${index}. ${doc.title}`;
                        }
                    } else {
                        titleEl.textContent = `スライド ${index}`;
                    }
                } catch (e) {
                    titleEl.textContent = `スライド ${index}`;
                }
            }

            // 初期表示（URLハッシュ優先）
            function initFromHash() {
                const num = parseInt((location.hash || '').replace('#', ''), 10);
                if (!Number.isNaN(num) && num >= 1 && num <= total) {
                    loadSlide(num, false);
                } else {
                    loadSlide(1, true);
                }
            }

            // ナビゲーション
            prevBtn.addEventListener('click', () => loadSlide(index - 1));
            nextBtn.addEventListener('click', () => loadSlide(index + 1));
            firstBtn.addEventListener('click', () => loadSlide(1));
            lastBtn.addEventListener('click', () => loadSlide(total));
            select.addEventListener('change', (e) => {
                const val = parseInt(e.target.value, 10);
                if (!Number.isNaN(val)) loadSlide(val);
            });
            openBtn.addEventListener('click', () => {
                window.open(slides[index - 1], '_blank');
            });
            fullBtn.addEventListener('click', async () => {
                if (!document.fullscreenElement) {
                    try { await app.requestFullscreen(); } catch {}
                } else {
                    try { await document.exitFullscreen(); } catch {}
                }
            });

            // キーボード操作
            window.addEventListener('keydown', (e) => {
                const tag = (e.target && e.target.tagName) || '';
                if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;
                if (['ArrowLeft', 'PageUp'].includes(e.key)) { e.preventDefault(); loadSlide(index - 1); }
                if (['ArrowRight', 'PageDown', ' '].includes(e.key)) { e.preventDefault(); loadSlide(index + 1); }
                if (e.key === 'Home') { e.preventDefault(); loadSlide(1); }
                if (e.key === 'End') { e.preventDefault(); loadSlide(total); }
                if (e.key === 'f' || e.key === 'F') { e.preventDefault(); fullBtn.click(); }
            });

            // スワイプ（簡易）
            let touchX = null;
            window.addEventListener('touchstart', (e) => { touchX = e.changedTouches[0].clientX; }, { passive: true });
            window.addEventListener('touchend', (e) => {
                if (touchX == null) return;
                const dx = e.changedTouches[0].clientX - touchX;
                if (Math.abs(dx) > 50) {
                    if (dx < 0) loadSlide(index + 1); else loadSlide(index - 1);
                }
                touchX = null;
            }, { passive: true });

            // ハッシュ遷移対応
            window.addEventListener('hashchange', () => {
                const num = parseInt((location.hash || '').replace('#', ''), 10);
                if (!Number.isNaN(num)) loadSlide(num, false);
            });

            // iframeロード時にタイトル取得
            frame.addEventListener('load', readFrameTitle);

            // 初期化
            initFromHash();
        })();
    </script>
</body>

</html>


